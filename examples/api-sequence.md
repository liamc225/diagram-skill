# Sequence Diagram â€” Checkout Flow

Auto-generated by `/diagram sequence checkout` from an API codebase with Stripe integration.

```mermaid
sequenceDiagram
    actor User
    participant App as Next.js Frontend
    participant API as API Route
    participant Cart as Cart Service
    participant Billing as Billing Service
    participant Stripe as Stripe API
    participant DB as PostgreSQL
    participant Email as Email Service

    User->>+App: Click "Checkout"
    App->>+API: POST /api/checkout
    API->>+Cart: getCart(userId)
    Cart->>+DB: SELECT cart_items
    DB-->>-Cart: items[]
    Cart-->>-API: cart with totals

    API->>+Billing: createCheckoutSession(cart)
    Billing->>+Stripe: POST /v1/checkout/sessions
    Stripe-->>-Billing: session { id, url }
    Billing->>DB: INSERT order (status: pending)
    Billing-->>-API: session_url

    API-->>-App: { redirect: session_url }
    App->>User: Redirect to Stripe Checkout

    Note over Stripe,API: After payment completes

    Stripe->>+API: POST /api/webhooks/stripe
    API->>+Billing: handlePaymentSuccess(event)
    Billing->>DB: UPDATE order SET status = paid
    Billing->>+Email: sendReceipt(order)
    Email-->>-Billing: sent
    Billing-->>-API: ok
    API-->>-Stripe: 200
```

Generated by [diagram-skill](https://github.com/YOUR_USERNAME/diagram-skill)
